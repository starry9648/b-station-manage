{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑用户 - 管理员界面</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">用户管理系统</a>
        <div class="d-flex align-items-center text-white">
            <span class="me-3">欢迎，{{ request.user.username }}</span>
            <a href="{% url 'logout' %}" class="btn btn-outline-light btn-sm">退出登录</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2>编辑用户</h2>
    <form method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">用户名</label>
            <input type="text" class="form-control" name="username" value="{{ user.username }}" required>
        </div>
        <div class="mb-3">
            <label class="form-label">密码</label>
            <input type="password" class="form-control" name="password">
        </div>
        <div class="mb-3">
            <label class="form-label">邮箱</label>
            <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
        </div>
        <div class="mb-3">
            <label class="form-label">手机号</label>
            <input type="tel" class="form-control" name="phone" value="{{ user.phone }}">
        </div>
        <div class="mb-3">
            <label class="form-label">国家</label>
            <input type="text" class="form-control" name="country" value="{{ user.country }}">
        </div>
        <div class="mb-3">
            <label class="form-label">出生日期</label>
            <input type="date" class="form-control" name="birthdate" value="{{ user.birthdate }}">
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" name="is_active" {% if user.is_active %}checked{% endif %}>
            <label class="form-check-label">激活状态</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" name="is_superuser" {% if user.is_superuser %}checked{% endif %}>
            <label class="form-check-label">管理员权限</label>
        </div>
        <button type="submit" class="btn btn-primary">保存</button>
        <a href="/user_list/" class="btn btn-secondary">取消</a>
        <button type="button" class="btn btn-danger ms-2" onclick="confirmDelete()">删除用户</button>
    </form>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/axios/1.6.7/axios.min.js"></script>
<script>
    function confirmDelete() {
        if (confirm('确定要删除该用户吗？此操作不可撤销。')) {
            deleteUser({{ user.id }});
        }
    }

    async function deleteUser(userId) {
        try {
            const response = await axios.delete(`/user/delete/${userId}/`, {
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                }
            });
            alert('用户已成功删除');
            window.location.href = '/user_list/';
        } catch (error) {
            alert('删除用户失败: ' + error.response.data.error);
        }
    }

    function getCSRFToken() {
        return document.querySelector('input[name=csrfmiddlewaretoken]').value;
    }
</script>
</body>
</html>